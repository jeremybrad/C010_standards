# C002_sadb Stage 2 Migration Gates

**Created:** 2026-01-01
**Status:** PLANNED (not started)
**Target:** Q1 2026 (when C019 work complete + pipeline workflows named)

---

## Overview

Stage 2 migrates C002_sadb from legacy folder structure to Betty Protocol compliance. This is HIGH complexity due to:
- Import dependencies across modules
- Hard-coded paths in scripts
- Pipeline expectations (S0-S2 stages)
- Active use by downstream consumers

**Key Principle:** If it's not used by the current pipeline, it gets archived, not refactored.

---

## Gate 0: Declare Freeze Window (Pre-work)

**Goal:** Don't refactor a moving target.

### Checklist
- [ ] Announce structural freeze in C002 (no new top-level dirs, no big renames)
- [ ] Capture baseline receipt:
  - [ ] Current top-level dirs listing
  - [ ] `grep` for path literals (hard-coded paths)
  - [ ] Import graph snapshot (even crude)
- [ ] Run `make pipeline` (or equivalent known-good command)
- [ ] Record output hash as canary

### Exit Condition
Reproduce "current working state" twice in a row (same tests/scripts succeed with same output).

---

## Gate 1: Inventory and Dependency Map

**Goal:** Categorize everything. No mystery meat.

### Flagged Dirs (from audit)
```
src, scripts, tests, test_data, tmp
2, 3, n8n, and, Sad, Bees, reviews, sadb_orders_1_2C
```

### Deliverables
- [ ] "Where does this belong?" mapping table
- [ ] List of hard-coded paths/imports that will break
- [ ] Classification for each dir: CODE | DATA | EVIDENCE | ARCHIVE | DELETE

### Exit Condition
Every top-level dir is categorized + has a destination bucket.

---

## Gate 2: Choose Target Structure (New Skeleton)

**Goal:** Lock destination paths once. Everything else is mechanical.

### Standard Mapping
| Source | Destination | Notes |
|--------|-------------|-------|
| `src/`, reusable modules | `40_src/` | Code |
| Run scripts, entrypoints | `00_run/` | Operational |
| Documentation | `10_docs/` | |
| Configs | `30_config/` | |
| Data outputs | `50_data/` or externalized | Prefer env var |
| Evidence, exports | `70_evidence/` | |
| Legacy dirs (2/, 3/, Sad/, etc.) | `90_archive/` | With README |
| tmp/ | `.gitignore` + `.stignore` | Not in repo |

### Exit Condition
Mapping written in receipt and treated as canonical.

---

## Gate 3: Add Compatibility Shims

**Goal:** Make the move without detonating imports.

### Shim Options
- [ ] Add `src/__init__.py` or path helper redirecting to new location
- [ ] Update Python packaging (no "repo root magic")
- [ ] Introduce `C002_ROOT` env var for pathy references
- [ ] Symlinks for backwards compat (temporary)

### Exit Condition
Repo works both before AND after the move using shim layer.

---

## Gate 4: Execute Migration

**Goal:** Do the moves in a branch, keep receipts tight.

### Steps
- [ ] Create branch: `refactor/stage2-folder-structure`
- [ ] `git mv` into target buckets
- [ ] Update imports/scripts/config references
- [ ] Rerun known "happy path" scripts and tests
- [ ] Create migration receipt with all moves

### Exit Condition
No "missing module / missing file" failures in standard workflows.

---

## Gate 5: Post-Migration Audit + Cleanup

**Goal:** Pass folder audit without new exceptions.

### Steps
- [ ] Rerun C010 folder structure audit
- [ ] Confirm C002 reports compliant (or has only documented exceptions)
- [ ] Remove shims once stable (optional)
- [ ] Update C002 README with new structure
- [ ] Final receipt with before/after comparison

### Exit Condition
Audit is clean. Receipt trail explains new structure.

---

## Start Conditions

Begin Gate 0 when:
1. C019 active work is complete (not juggling structural changes across repos)
2. We can name the exact workflows we refuse to break:
   - [ ] `make pipeline` (db-init → index → export-twin → stats)
   - [ ] `python3 40_src/sadb_q.py stats`
   - [ ] `bash scripts/ingest_chatgpt_downloads.sh`
   - [ ] (add others as identified)

---

## Key Decisions (Pre-agreed)

1. **Legacy dirs → Archive:** `2/`, `3/`, `and/`, `Sad/`, `Bees/`, `reviews/`, `sadb_orders_1_2C/` go to `90_archive/` with explanatory README unless actively called by pipeline.

2. **Pipeline is the oracle:** If a script/module isn't in the pipeline's call graph, it's archive material.

3. **Shim before move:** Never break imports. Add compatibility layer first, migrate second, remove shims third.

---

## Session Attribution
Planning receipt created by Claude Code (Opus 4.5) on 2026-01-01
